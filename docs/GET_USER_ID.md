# ユーザーIDを手動で取得する方法

このドキュメントでは、新しくBotを友だち追加してくれた人のLINEユーザーIDを取得するための手順を説明します。

`ngrok` というツールと、このプロジェクトに含まれる `getUserId.js` というプログラムを使います。

## 必要なもの

- あなたのPC（ターミナルやコマンドプロンプトが使えること）
- [Node.js](https://nodejs.org/) （このプロジェクトを動かすためにインストール済みのはずです）
- [ngrok](https://ngrok.com/)

---

## 手順

### 1. ngrok の準備

`ngrok`は、あなたのPCで動いているプログラムを、一時的にインターネットの世界に公開してくれるツールです。

1.  **ngrokをインストールする**
    - まだインストールしていない場合は、[公式サイト](https://ngrok.com/download) からダウンロードしてインストールしてください。
    - Homebrewを使っている場合: `brew install ngrok`

2.  **ngrokアカウントに接続する**
    - `ngrok`のサイトで無料アカウントを作成します。
    - ダッシュボードに表示される `authtoken` を設定します。
      ```bash
      ngrok config add-authtoken 36WHxe4pCa7FAejs2bsZMSbhHi3_6ES7br14mqDaePp9Kxnid
      ```

### 2. ユーザーID取得サーバーを起動する

次に、あなたのPCで `getUserId.js` を動かします。

1.  **ターミナルを開く**:
    - このプロジェクト (`gunpla-stock-bot`) のフォルダに移動してください。

2.  **サーバーを起動する**:
    - 以下のコマンドを実行します。
      ```bash
      node getUserId.js
      ```
    - `サーバーが http://localhost:3000 で起動しました。` と表示されれば成功です。

### 3. ngrok でPCをインターネットに公開する

`getUserId.js`が動いている状態で、**別の新しいターミナルを開いて**、以下の作業を行います。

1.  **ngrokを起動する**:
    - 新しいターミナルで、以下のコマンドを実行します。
      ```bash
      ngrok http 3000
      ```

2.  **Webhook URLをコピーする**:
    - 画面に `Forwarding` という項目が表示されます。
    - `https://` から始まるURL（例: `https://1a2b-3c4d-5e6f.ngrok-free.app`）をコピーします。これが一時的にあなたのPCにつながるインターネット上の住所になります。

### 4. LINE Developersコンソールで設定する

1.  [LINE Developersコンソール](https://developers.line.biz/)にログインします。
2.  あなたのBotのプロバイダーとチャネルを選択します。
3.  「Messaging API設定」タブを開きます。
4.  「Webhook URL」の「編集」ボタンを押します。
5.  先ほどコピーした **ngrokのURL** の後ろに `/webhook` を付け足したものを貼り付けます。
    - 例: `https://1a2b-3c4d-5e6f.ngrok-free.app/webhook`
6.  「更新」ボタンを押します。
7.  「Webhookの利用」のトグルスイッチを **オン** にします。

### 5. ユーザーIDを取得する

さあ、準備は整いました！

1.  **友だちにメッセージを送ってもらう**:
    - IDを知りたいお友達に、あなたのBotのLINE公式アカウントへ、何か好きなメッセージやスタンプを送ってもらいます。

2.  **ターミナルでIDを確認する**:
    - `getUserId.js` を実行している方のターミナルの画面を見てください。
    - 以下のような表示が追加されているはずです。
      ```
      ✨✨✨ ユーザーIDが見つかりました！ ✨✨✨
      以下のIDをコピーして config/users.csv に追加してください。

      UserID: U1234567890abcdef1234567890abcdef

      ✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨✨
      ```

3.  **IDをコピーして保存する**:
    - 表示された `U` から始まる33文字のユーザーIDをコピーします。
    - `config/users.csv` ファイルを開き、新しい行にコピーしたIDを追加します。

### 6. 後片付け

ユーザーIDの取得が終わったら、**必ず後片付けをしてください。**

1.  **LINE Developersコンソール**:
    - 「Webhookの利用」のトグルスイッチを **オフ** に戻します。
    - Webhook URLも空にしておくのが安全です。

2.  **ターミナル**:
    - `ngrok` を実行しているターミナルで `Ctrl + C` を押して終了します。
    - `getUserId.js` を実行しているターミナルで `Ctrl + C` を押して終了します。

これで作業は完了です。お疲れ様でした！
