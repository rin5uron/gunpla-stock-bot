# ガンプラ在庫監視Bot

プレミアムバンダイの商品在庫を自動で監視し、在庫が復活したらLINEで通知するシンプルなBotです。

### 主な機能

- **在庫の自動チェック**: 30分おきに在庫状況を自動で確認（ボタン判定による検出）。
- **LINEで通知**: 在庫復活を検知したら、登録ユーザー全員に商品URLをLINEでプッシュ通知。
- **CSV管理**: 監視対象商品と通知先ユーザーをCSVファイルで簡単に管理。

---

## 🚀 セットアップ

このBotは、GitHub Actionsの無料枠を使ってセットアップできます。

**詳細な手順はこちらのガイドをご覧ください:**

👉 **[セットアップガイド](./docs/SETUP.md)**

---

## 📚 ドキュメント

プロジェクトの詳細な情報は、以下のドキュメントをご覧ください：

- **[セットアップガイド](./docs/SETUP.md)** - 初期セットアップの手順
- **[仕様書](./docs/SPECIFICATION.md)** - プロジェクトの詳細な仕様とファイル構成
- **[テスト方法](./docs/TESTING.md)** - ローカルでのテスト方法と動作確認
- **[ユーザーIDの取得方法](./docs.md)** - LINE通知先のユーザーIDを取得する手順

---

## アーキテクチャ

- **設定ファイル (CSV)**:
  - `config/targets.csv`: 監視対象商品の管理（ID、商品名、URL、最終在庫状態）
  - `config/users.csv`: LINE通知先ユーザーの管理（LINE ユーザーID、表示名）
- **在庫チェッカー (GitHub Actions)**:
  - 30分おきに起動し、Playwrightを使って商品ページのボタン判定により在庫を確認。
  - 在庫復活を検知したら、LINE Messaging APIで全ユーザーに商品URLを通知。
  - スクレイピング対策のため、カート投入などの自動操作は一切行わない。

---

## ⚠️ 注意

- このBotは、プレミアムバンダイの利用規約を遵守する範囲で、個人の購入補助を目的としています。商業目的での利用や、他者への迷惑となるような過度な利用は固く禁じます。
- 本Botは在庫復活を通知するのみで、**自動購入・自動カート投入は一切行いません**。ボタンのテキスト判定のみで在庫状態を検出します。
- スクレイピング対策およびアカウントBAN防止のため、カート投入などの自動操作機能は実装していません。通知を受け取ったら、手動で購入手続きを行ってください。
- 本プログラムの利用によって生じたいかなる損害についても、開発者は責任を負いません。自己責任でご利用ください。

---
# 学習記録

## 目次
- [2025/12/7](#2025127)
  - [LINEユーザーIDについて](#lineユーザーidについて)
  - [スクレイピングについて](#スクレイピングについて)

---

## 2025/12/7

### LINEユーザーIDについて

- 友達全員のユーザーIDを取得するには、認証済みアカウントまたはプレミアムプランへの加入が必要。
　- 上記以外の場合はWebhookで取得する
　  - 今回のプロジェクトではwebhookを使ったプログラムを実装し、ID取得が必要な場合に手動で実行することによりクライアントのI Dを取得する

#### 参考資料
- [LINE Developersドキュメント](https://developers.line.biz/ja/docs/messaging-api/getting-user-ids/)
- 画像資料
  ![robots.txt](./images/robots.txt.png)

---

### スクレイピングについて

- **サイトマップ**: Googleにコンテンツを認識させ、SEO対策やクローラー対策として利用される。
  - 例: `https://slo-map.com/sitemap.xml`
- **robots.txt**: クローラー（ロボット）のアクセスを制御するためのファイル。
  - 例: `https://slo-map.com/robots.txt`
- スクレイピングの善悪は、**悪意の有無**と**サーバーへの負荷**が重要な判断基準となる。

#### 岡崎市立中央図書館事件（Librahack事件）

この事件以後、Webスクレイピングに関する大きな事件は特に報告されていないが、重要な教訓を残した。

- **事件の経緯**:
  - 2010年3月: ある男性が、岡崎市立中央図書館の新刊情報を自動取得するプログラム（約1秒に1回のアクセス）を実行。
  - 2010年5月25日: 「偽計業務妨害」の容疑で逮捕。理由は「大量アクセスでシステムを利用不能にした」こと。

- **事件の背景**:
  - 図書館側のシステムに脆弱性があり、通常のアクセスでも高負荷に耐えられない状態だった。
  - 男性に攻撃の意図はなく、個人的な情報収集が目的だった。

- **最終的な結果**:
  - **不起訴処分（起訴猶予）** となり、裁判は行われなかった（無罪判決ではない）。

- **影響と教訓**:
  - この事件は、Webスクレイピングの法的リスクと、サービス提供者側のシステム堅牢性の重要性についての議論を巻き起こした。
  - 悪意がなくとも、過度なアクセスでサーバーに負荷をかける行為は業務妨害と見なされるリスクがある。
  - 一般的に、**1秒に1回程度のアクセス**が、サーバーに配慮したアクセス頻度の一つの目安とされている。
